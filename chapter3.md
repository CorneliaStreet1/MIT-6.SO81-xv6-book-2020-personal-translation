# 第三章

# 页表

页表是操作系统用来给每个进程提供其私有的地址空间和内存的的机制。页表确定了地址意味着什么内存，物理内存的哪部分可以被访问。它们使得xv6得以隔离不同进程的地址空间以及在单个硬件上复用它们。页表同样提供了某种程度上间接允许xv6使用一些技巧：将同一部分内存（trampoline page）映射到多个地址空间，以及用未映射的页表监视（guarding）内核和用户栈。本章的剩余部分解释RISC-V硬件提供的页表以及xv6如何使用它们。

## 3.1	页式硬件(paging hardware)

作为复习，RISC-V指令（用户指令以及内核指令）操控的是虚拟地址。机器的RAM，或者说物理内存，是用物理地址编制索引的。RISC-V的页表硬件通过将每个虚拟地址映射到一个物理地址来将这两种地址联系在一起。

xv6基于Sv39 RISC-V运行，这意味着一个64比特的地址只有它的最后39位被使用；顶部25位不被使用。在这种Sv39配置下，一个RISC-V页表逻辑上来说是一个由2^27个页表项（PTE）构成的数组。每个PTE包含一个44比特的物理页数（PPN）以及一些标志。页表硬件翻译虚拟地址的过程如下：用39比特中的前27比特来索引到页表中的PTE，然后创建一个56比特的物理地址，这个物理地址的前44比特由来自PTE中的PPN，后12比特则是从原始虚拟地址复制过来的。Figure3.1

